/**
 * Composite plugin.
 */
new function () {

    var SEARCH_REPLACE_URL = "${tiny}/plugins/compositesearchandreplace/visualsearchandreplace.aspx";

    var each = tinymce.each, Event = tinymce.dom.Event;

    tinymce.create("tinymce.plugins.CompositeSearchAndReplacePlugin", {

		/**
		 * @type {tinymce.Editor}
		 */
        editor: null,

		/**
		 * Get info
		 */
        getInfo: function () {
            return {
                longname: "Composite Search and Replace Plugin",
                author: "Peter Edwards",
                authorurl: "https://www.iihs.org/",
                infourl: null,
                version: tinymce.majorVersion + "." + tinymce.minorVersion
            };
        },

		/**
		 * @param {tinymce.Editor} ed
		 * @param {string} url
		 */
        init: function (ed, url) {
            this.editor = ed;
            var self = this;
            
            //Remove searchreplace plugin shortcut and replace with composite search and replace shortcut
            ed.shortcuts.remove('Meta+F');
            ed.shortcuts.add('Meta+F', '', function () { this.execCommand("compositeSearchAndReplace"); });
            ed.shortcuts.add('Meta+H', '', function () { this.execCommand("compositeSearchAndReplace"); });
        },

		/**
		 * @param {string} cmd
		 * @param {boolean} ui
		 * @param {string} value
		 */
        execCommand: function (cmd, ui, value) {

            var result = false;
            var self = this;
            var editor = this.editor;
            var editorBinding = editor.theme.editorBinding;

            if (cmd == "compositeSearchAndReplace") {
                //this._insertComponent();
                this._searchAndReplaceDialog();
                editorBinding.checkForDirty();
                result = true;
            }
            return result;
        },

        _searchAndReplaceDialog: function () {

            this.editor.theme.enableDialogMode();
            var self = this;
            var plugin = this.editor.plugins.searchreplace;

            var self = this;
            var handler = {
                handleDialogResponse: function (response, result) {
                    self.editor.theme.disableDialogMode();
                }
            };
            var args = {
                editor: this.editor,
                plugin: plugin
            };
            Dialog.invokeModal(SEARCH_REPLACE_URL, handler, args);
            return true;
        }
    });

    // Register plugin
    tinymce.PluginManager.add("compositesearchandreplace", tinymce.plugins.CompositeSearchAndReplacePlugin);
};
