function _UpdateManager(){var a=null;return window.UpdateManager||(this._construct(),a=this),a}function _UpdateAssistant(){var a=null;return window.UpdateAssistant||(this._construct(),a=this),a}function UpdatePlugin(){this.handleElement=function(a,b){var c=!1;switch(a.nodeName.toLowerCase()){case"input":case"textarea":switch(a.getAttribute("id")){case"__EVENTTARGET":case"__EVENTARGUMENT":case"__VIEWSTATE":case"__EVENTVALIDATION":c=!1}}return c},this.updateElement=function(a,b){var c=a.getAttribute("id"),d=document.getElementById(c);if(null!=d){var e=null;switch(d.nodeName.toLowerCase()){case"input":e=a.getAttribute("value");break;case"textarea":e=a.textContent?a.textContent:a.text}null==e&&(e=""),e!=d.value&&(d.value=e,UpdateManager.report('Property [value] updated on field "'+c+'"'))}return!0}}function Update(){return this}function ReplaceUpdate(a,b){return this.type=Update.TYPE_REPLACE,this.id=a,this.element=b,this}function SiblingUpdate(a,b,c,d){return this.type=a,this.id=b,this.element=c,this.isFirst=d,this}function AttributesUpdate(a,b,c){return this.type=type=Update.TYPE_ATTRIBUTES,this.id=a,this.element=b,this.currentElement=c,this._summary=[],this}function _WindowManager(){this._construct(KeyMaster.getUniqueKey())}function _DocumentUpdatePlugin(){null!=window.UpdateManager&&(UpdateManager.plugins.push(this),this._setup())}function DocumentCrawler(){return this.mode=DocumentCrawler.MODE_REGISTER,this.id=DocumentCrawler.ID,this._construct(),this}function _DocumentManager(){this._construct()}function _DataManager(){}_UpdateManager.prototype={version:"0.1",CLASSNAME_FORM:"updateform",CLASSNAME_ZONE:"updatezone",CLASSNAME_GONE:"updategone",EVENT_BEFOREUPDATE:"beforeupdate",EVENT_AFTERUPDATE:"afterupdate",EVENT_ERRORUPDATE:"errorupdate",xhtml:null,summary:null,isEnabled:!0,isDebugging:!1,isUpdating:!1,hasSoftAttributes:!1,hasSoftSiblings:!1,pendingResponse:null,currentDOM:null,errormessage:null,_assistant:null,_updates:null,_replaced:null,_dotnetnames:["__VIEWSTATE","__EVENTVALIDATION","__EVENTTARGET","__EVENTARGUMENT","__LASTFOCUS"],plugins:[],toString:function(){return"[object UpdateManager]"},_construct:function(a){var b=document.documentElement,c=b.namespaceURI;null==c&&(c=new String(b.getAttribute("xmlns"))),"http://www.w3.org/1999/xhtml"==c?(this._addListener(window,"load"),this._addListener(window,"unload")):this.error("Not an XHTML document!")},_setup:function(){if(this.isEnabled&&(this.isEnabled=this.setupForms(),this.isEnabled))if(null!=this.xhtml){if("string"!=typeof this.xhtml)throw new TypeError;var a=decodeURIComponent(this.xhtml);this.currentDOM=UpdateAssistant.parse(a)}else{var b=this;UpdateAssistant.getXMLHttpRequest("get",window.location.toString(),{handleResponse:function(a){b.currentDOM=a}}).send(null)}},setupForms:function(){var a=!1;return Array.forEach(document.forms,function(b){b.className.indexOf(this.CLASSNAME_FORM)>-1&&(b.__isSetup||(this._setupForm(b),b.__isSetup=!0),a=!0)},this),a},_setupForm:function(a){var b=this;this._addListener(a,"submit"),a.__submit=a.submit,a.submit=function(){return b.isEnabled?b._submit(a):a.__submit(),!1}},_addListener:function(a,b){if(null!=a.addEventListener)a.addEventListener(b,this,!1);else{var c=this;a.attachEvent("on"+b,function(){c.handleEvent(window.event)})}},handleEvent:function(a){switch(a.type){case"load":this.isEnabled&&this._setup();break;case"unload":this.isEnabled=!1;break;case"submit":if(this.isEnabled){document.all?a.returnValue=!1:a.preventDefault();var b=a.target?a.target:a.srcElement;this._submit(b)}}},_submit:function(a){this.isUpdating||(this.isUpdating=!0,UpdateAssistant.dispatchEvent(document.documentElement,this.EVENT_BEFOREUPDATE),this._postRequest(a))},handleResponse:function(a){if(this.isEnabled&&(this.summary=new String(""),this.errors=new String(""),null!=a)){var b=UpdateAssistant.getUpdateZones(a),c=UpdateAssistant.getUpdateZones(this.currentDOM);this._updates=[],this._replaced={},b.forEach(function(a,b){var d=c[b];this._crawl(a,d)},this),this._updates.forEach(function(a,b){a.update(),a.dispose()},this),this._dotnetnames.forEach(function(b){this._fixdotnet(a,b)},this),this.currentDOM=a}this.isUpdating=!1,UpdateAssistant.dispatchEvent(document.documentElement,this.EVENT_AFTERUPDATE)},handleSimilarResponse:function(){UpdateAssistant.dispatchEvent(document.documentElement,this.EVENT_AFTERUPDATE)},_crawl:function(a,b,c,d){var e=!0,f=b.getAttribute("class");if(null==f||f.indexOf(this.CLASSNAME_GONE)==-1){if(b.nodeType==Node.ELEMENT_NODE){var g=b.getAttribute("id");null!=g&&(c=a,d=g)}if(e=this._check(a,b,c,d))for(var h=a.firstChild,i=b.firstChild;null!=h&&null!=i&&!this._replaced[d];){switch(h.nodeType){case Node.TEXT_NODE:e=this._check(h,i,c,d);break;case Node.DOCUMENT_NODE:case Node.ELEMENT_NODE:e=this._crawl(h,i,c,d)}this._replaced[d]?e=!1:(h=h.nextSibling,i=i.nextSibling)}}return e},_check:function(a,b,c,d){var e=!0,f=null,g=!1,h=!1;if(null!=a&&null==b||null==a&&null!=b)e=!1;else if(e=a.nodeType==b.nodeType)switch(b.nodeType){case Node.ELEMENT_NODE:if(a.namespaceURI!=b.namespaceURI||a.nodeName!=b.nodeName)e=!1;else if(e=a.nodeName==b.nodeName){var i=b.getAttribute("id"),j=a.getAttribute("id");null!=i&&null!=j&&(i!=j?e=!1:null!=(f=this._getPlugin(a,b))&&f.updateElement(a,b)&&(h=!0,e=!1)),e&&(e=this._checkAttributes(a,b))&&(this.hasSoftSiblings&&this._hasSoftChildren(a)&&this._hasSoftChildren(b)?(this._validateSoftChildren(a,b)&&(this._updateSoftChildren(a,b),g=!0),e=!1):e=a.childNodes.length==b.childNodes.length)}break;case Node.TEXT_NODE:a.data.trim()!=b.data.trim()&&(e=!1)}return 0!=e||g||h||null!=d&&null!=c&&this.addUpdate(new ReplaceUpdate(d,c)),e},_checkAttributes:function(a,b){var c=!0,d=!1,e=a.attributes,f=b.attributes;if(d=e.length!=f.length||!Array.every(e,function(a,b){var c=f.item(b);return a.nodeName==c.nodeName&&a.nodeValue==c.nodeValue})){var g=a.getAttribute("id"),h=b.getAttribute("id");this.hasSoftAttributes&&null!=g&&g==h?this.addUpdate(new AttributesUpdate(h,a,b)):c=!1}return c},_hasSoftChildren:function(a){var b=!0;return a.hasChildNodes()&&(b=Array.every(a.childNodes,function(a){var b=!0;switch(a.nodeType){case Node.TEXT_NODE:b=!/[^\t\n\r ]/.test(a.nodeValue);break;case Node.ELEMENT_NODE:b=null!=a.getAttribute("id")}return b})),b},_validateSoftChildren:function(a,b){var c=!0,d=-1,e=-1,f=-1,g=this._toMap(a.childNodes,!0),h=this._toMap(b.childNodes,!0);for(var i in h){if(c){var j=h[i];c=j>=d,null!=g[i]&&(f=g[i],c=f>=e)}d=j,f>-1&&(e=f)}return c},_updateSoftChildren:function(a,b){var c=this._toMap(a.childNodes),d=this._toMap(b.childNodes);for(var e in d)null==c[e]?this.addUpdate(new SiblingUpdate(Update.TYPE_REMOVE,e,null,null)):this._crawl(c[e],d[e]);var f=null;for(e in c){if(null==d[e]){var g=c[e];if(null==f){var h=b.getAttribute("id");this.addUpdate(new SiblingUpdate(Update.TYPE_INSERT,h,g,!0))}else this.addUpdate(new SiblingUpdate(Update.TYPE_INSERT,f,g,!1))}f=e}},addUpdate:function(a){this._updates.push(a),a instanceof ReplaceUpdate&&(this._replaced[a.id]=!0)},_getPlugin:function(a,b){var c=null;return this.plugins.every(function(d){return d.handleElement(a,b)&&(c=d),null==c}),c},_toMap:function(a,b){var c={};return Array.forEach(a,function(a,d){a.nodeType==Node.ELEMENT_NODE&&(c[a.getAttribute("id")]=b?d:a)}),c},_getPost:function(a){var b=new String("");if(null!=a){var c="";Array.forEach(a.elements,function(a){if(null!=a.name&&""!=a.name){var d=a.name,e=encodeURIComponent(a.value);switch(a.type){case"button":case"submit":var f=UpdateAssistant.getActiveElement();a==f&&""!=d&&(b+=d+"="+e+"&");break;case"radio":a.checked&&(b+=d+"="+e+"&");break;case"checkbox":a.checked&&(a.name==c?(b.lastIndexOf("&")==b.length-1&&(b=b.substr(0,b.length-1)),b+=","+e):b+=d+"="+a.value,c=d,b+="&");break;case"text":case"hidden":case"password":case"textarea":case"select-one":b+=d+"="+e+"&"}}})}return b.substr(0,b.length-1)},_postRequest:function(a){var b=""!=a.method?a.method:"get",c=""!=a.action?a.action:window.location.toString(),d=this._getPost(a);"get"==b&&c.indexOf("?")>-1&&(c=c+"&"+d);var e=UpdateAssistant.getXMLHttpRequest(b,c,this);"post"==b&&e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.send("post"==b?d:null)},_fixdotnet:function(a,b){var c=document.getElementById(b);if(null!=c){var d=UpdateAssistant.getElementById(a,b);if(null!=d){var e=d.getAttribute("value");e!==c.value&&(c.value=e)}}},debug:function(a){this.isDebugging&&alert("UpdateManager dysfunction. \n\n"+a)},error:function(a){this.errorsmessage=a,UpdateAssistant.dispatchEvent(document.documentElement,UpdateManager.EVENT_ERRORUPDATE),this.debug(a)},report:function(a){this.summary+=a+"\n"}};var UpdateManager=new _UpdateManager;_UpdateAssistant.prototype={_serializer:null!=window.XMLSerializer?new XMLSerializer:null,_parser:null!=window.DOMParser&&null!=window.XPathResult?new DOMParser:null,_activeElement:null,_construct:function(){window.Node||(window.Node={ELEMENT_NODE:1,TEXT_NODE:3,DOCUMENT_NODE:9}),Array.every||(Array.every=function(a,b){var c=!0,d=a.length>>>0;if("function"!=typeof b)throw new TypeError;for(var e=arguments[2],f=0;f<d;f++)if("undefined"!=typeof a[f]&&!b.call(e,a[f],f,a)){c=!1;break}return c}),Array.prototype.every||(Array.prototype.every=function(a){var b=arguments[1];return Array.every(this,a,b)}),Array.forEach||(Array.forEach=function(a,b){var c=a.length>>>0;if("function"!=typeof b)throw new TypeError;for(var d=arguments[2],e=0;e<c;e++)"undefined"!=typeof a[e]&&b.call(d,a[e],e,a)}),Array.prototype.forEach||(Array.prototype.forEach=function(a){var b=arguments[1];Array.forEach(this,a,b)}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s*/,"").replace(/\s*$/,"")}),null!=document.addEventListener&&(document.addEventListener("focus",this,!1),document.addEventListener("blur",this,!1),document.addEventListener("mousedown",this,!1))},handleEvent:function(a){switch(a.type){case"focus":case"mousedown":this._activeElement=a.target;break;case"blur":this._activeElement==a.target&&(this._activeElement=null)}},getXMLHttpRequest:function(a,b,c){function d(){if(4==e.readyState){var a=e.getResponseHeader("X-Error-Type");if(a){for(var d="",f=0;f<10;f++){var g=f?f:"",a=e.getResponseHeader("X-Error-Type"+g);if(!a)break;var h=e.getResponseHeader("X-Error-Message"+g);d+=a+"\n"+h+"\n"}Dialog.error("Error",d)}else{var i=e.responseText;UpdateManager.pendingResponse=i;var j=UpdateAssistant.parse(i);null!=j&&c.handleResponse(j)}Application.unlock(b)}}var e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Msxml2.XMLHTTP.3.0");return null!=e&&(e.open(a,b,null!=c),null!=c&&(Application.lock(b),null!=e.addEventListener?e.addEventListener("readystatechange",{handleEvent:function(){d()}},!1):e.onreadystatechange=d)),e},dispatchEvent:function(a,b){var c=!0,d=document.createEvent("UIEvents");return d.initEvent(b,!0,!0),c=a.dispatchEvent(d)},getUpdateZones:function(a){var b="//*[@id and contains(@class,'updatezone')]",c=[],d=null,e=null;if(null!=window.XPathResult){var f=XPathResult.ORDERED_NODE_ITERATOR_TYPE;for(d=a.evaluate(b,a,null,f,null);null!=(e=d.iterateNext());)c.push(e)}else d=a.documentElement.selectNodes(b),Array.forEach(d,function(a){c.push(a)});return c},getElementById:function(a,b){var c="//*[@id='"+b+"']",d=null,e=null;if(null!=window.XPathResult){var f=XPathResult.FIRST_ORDERED_NODE_TYPE;d=a.evaluate(c,a,null,f,null),e=d.singleNodeValue}else e=a.documentElement.selectNodes(c)[0];return e},_getIds:function(a){var b="//*[@id]",c=null,d=[];if(null!=window.XPathResult){var e=XPathResult.ORDERED_NODE_ITERATOR_TYPE;for(c=a.evaluate(b,a,null,e,null);null!=(element=c.iterateNext());)d.push(element.getAttribute("id"))}else c=a.documentElement.selectNodes(b),Array.forEach(c,function(a){d.push(a.getAttribute("id"))});return d},toHTMLElement:function(a){var b=this.serialize(a),c=document.createElement("temp");return c.innerHTML=b,c.firstChild},getActiveElement:function(){var a=document.activeElement;return null!=a&&a!=document.body||(a=this._activeElement),a},serialize:function(a){var b=null;return null!=a.xml?b=a.xml:null!=this._serializer&&(b=this._serializer.serializeToString(a)),b},hasDifferences:function(a,b){var c=null,d=null;return null!=a.xml?(c=a.xml,d=b.xml):null!=this._serializer&&(c=this._serializer.serializeToString(a),d=this._serializer.serializeToString(b)),c!=d},parse:function(a){var b=null;return null!=this._parser&&null!=window.XPathResult?b=this._parser.parseFromString(a,"text/xml"):(b=new ActiveXObject("Msxml2.DOMDocument.3.0"),b.setProperty("SelectionLanguage","XPath"),b.loadXML(a)),this._validate(b)},_validate:function(a){var b=null;if(null!=a.parseError&&0!=a.parseError.errorCode)b=a.parseError.reason;else{var c=a.getElementsByTagName("parsererror").item(0);null!=c&&(b=c.textContent.replace(/\^/g,"").replace(/\-/g,""))}if(null==b){var d={},e=this._getIds(a);e.every(function(a){var c=!d[a];return d[a]=!0,c||(b='Element "'+a+'" encountered twice.'),c})}return null!=b&&(UpdateManager.error(b),a=null),a}};var UpdateAssistant=new _UpdateAssistant;UpdateManager.plugins.push(new UpdatePlugin),Update.TYPE_REPLACE="replace",Update.TYPE_ATTRIBUTES="attributes",Update.TYPE_REMOVE="remove",Update.TYPE_INSERT="insert",Update.EVENT_BEFOREUPDATE="beforeupdate",Update.EVENT_AFTERUPDATE="afterupdate",Update.prototype={type:null,key:null,id:null,element:null,update:function(){},dispose:function(){this.element=null},_beforeUpdate:function(a){var b=!0;return null!=a&&(a.__updateType=this.type,b=UpdateAssistant.dispatchEvent(a,Update.EVENT_BEFOREUPDATE)),b},_afterUpdate:function(a){var b=!0;return null!=a&&(a.__updateType=this.type,b=UpdateAssistant.dispatchEvent(a,Update.EVENT_AFTERUPDATE)),b}},ReplaceUpdate.prototype=new Update,ReplaceUpdate.superclass=Update.prototype,ReplaceUpdate.prototype.update=function(){var a,b,c=UpdateAssistant.toHTMLElement(this.element);if(null!=(a=document.getElementById(this.id))){if(null!=(b=a.parentNode)){var d=UserInterface.getBinding(a);null!=d&&(c.__isAttached=d.isAttached),this._beforeUpdate(a)&&(b.replaceChild(c,a),this._afterUpdate(c))}}else UpdateManager.error("Element null point: "+this.id)},ReplaceUpdate.prototype._afterUpdate=function(a){var b=ReplaceUpdate.superclass._afterUpdate.call(this,a);return UpdateManager.report('Replaced element id="'+this.id+'"'),"form"!=a.nodeName&&null==a.getElementsByTagName("form").item(0)||UpdateManager.setupForms(),b},SiblingUpdate.prototype=new Update,SiblingUpdate.superclass=Update.prototype,SiblingUpdate.prototype.update=function(){var a=document.getElementById(this.id);switch(this.type){case Update.TYPE_REMOVE:this._remove(a);break;case Update.TYPE_INSERT:this._insert(this.element,a)}},SiblingUpdate.prototype._remove=function(a){var b=a.parentNode;null!=b&&this._beforeUpdate(a)&&(b.removeChild(a),this._afterUpdate(b))},SiblingUpdate.prototype._insert=function(a,b){var c=UpdateAssistant.toHTMLElement(a);if(this.isFirst){var d=b;null!=d&&this._beforeUpdate(d)&&(d.insertBefore(c,d.firstChild),this._afterUpdate(c))}else{var d=b.parentNode;null!=d&&this._beforeUpdate(d)&&(d.insertBefore(c,b.nextSibling),this._afterUpdate(c))}},SiblingUpdate.prototype._beforeUpdate=function(a){var b=SiblingUpdate.superclass._beforeUpdate.call(this,a);return this.type==Update.TYPE_REMOVE&&UpdateManager.report('Removed element id="'+a.id+'"'),b},SiblingUpdate.prototype._afterUpdate=function(a){var b=!0;return null!=a&&(b=SiblingUpdate.superclass._afterUpdate.call(this,a),this.type==Update.TYPE_INSERT&&(UpdateManager.report('Inserted element id="'+a.id+'"'),"form"!=a.nodeName&&null==a.getElementsByTagName("form").item(0)||UpdateManager.setupForms())),b},AttributesUpdate.prototype=new Update,AttributesUpdate.superclass=Update.prototype,AttributesUpdate.prototype.currentElement=null,AttributesUpdate.prototype.update=function(){var a=document.getElementById(this.id);this._beforeUpdate(a)&&(this._updateAttributes(a),this._afterUpdate(a))},AttributesUpdate.prototype._updateAttributes=function(a){Array.forEach(this.element.attributes,function(b){var c=this.currentElement.getAttribute(b.nodeName);null!=c&&c==b.nodeValue||(this._setAttribute(a,b.nodeName,b.nodeValue),this._summary.push("@"+b.nodeName))},this),Array.forEach(this.currentElement.attributes,function(b){null==this.element.getAttribute(b.nodeName)&&(this._setAttribute(a,b.nodeName,null),this._summary.push("@"+b.nodeName))},this)},AttributesUpdate.prototype._setAttribute=function(a,b,c){null==a&&(alert(this.id+": "+document.getElementById(this.id)+"\n\n"+b+"="+c),SystemLogger.getLogger("AttributesUpdate").fine(document.body.innerHTML));var d=null==c;if(d?a.removeAttribute(b):a.setAttribute(b,c),null!=document.all)switch(d&&(c=""),b.toLowerCase()){case"class":a.className=c;break;case"disabled":a.disabled=!d;break;case"checked":a.checked=!d;break;case"readonly":a.readOnly=!d}},AttributesUpdate.prototype._afterUpdate=function(a){AttributesUpdate.superclass._afterUpdate.call(this,a),UpdateManager.report('Attributes updated on element id="'+this.id+'": '+this._summary.toString())},AttributesUpdate.prototype.dispose=function(){Update.prototype.dispose.call(this),this.currentElement=null},window.Node||(window.Node={ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12}),window.KeyEventCodes={VK_BACK:8,VK_TAB:9,VK_ENTER:13,VK_SHIFT:16,VK_CONTROL:17,VK_ALT:18,VK_ESCAPE:27,VK_SPACE:32,VK_PAGE_UP:33,VK_PAGE_DOWN:34,VK_END:35,VK_HOME:36,VK_LEFT:37,VK_UP:38,VK_RIGHT:39,VK_DOWN:40,VK_COMMAND:91,VK_INSERT:null,VK_DELETE:127,VK_PLUS:187,VK_MINUS:189,VK_NUMPLUS:107,VK_NUMMINUS:109,VK_F1:112},window==top?window.app=this:window.app=top.app,window.bindingMap={},window.standardEventHandler=null,window!=window.top&&top.Application.declareTopLocal(window),_WindowManager.prototype={WINDOW_LOADED_BROADCAST:null,WINDOW_UNLOADED_BROADCAST:null,WINDOW_EVALUATED_BROADCAST:null,WINDOW_RESIZED_BROADCAST:null,isWindowLoaded:!1,_logger:SystemLogger.getLogger("WindowManager ["+document.title+"]"),_ondomstatements:new List,_onloadstatements:new List,_onresizestatements:new List,_currentDimensions:null,_newDimensions:null,_broadcastTimeout:null,_isHorizontalResize:!1,_isVerticalResize:!1,_broadcastTimeout:null,_compute:function(a,b){return a.replace("${windowkey}",document.location+":"+b)},_construct:function(a){this.WINDOW_LOADED_BROADCAST=this._compute(BroadcastMessages.$WINKEY_LOADED,a),this.WINDOW_UNLOADED_BROADCAST=this._compute(BroadcastMessages.$WINKEY_UNLOADED,a),this.WINDOW_EVALUATED_BROADCAST=this._compute(BroadcastMessages.$WINKEY_EVALUATED,a),this.WINDOW_RESIZED_BROADCAST=this._compute(BroadcastMessages.$WINKEY_RESIZED,a),DOMEvents.addEventListener(window,DOMEvents.DOM,this),DOMEvents.addEventListener(window,DOMEvents.LOAD,this),DOMEvents.addEventListener(window,DOMEvents.UNLOAD,this)},handleEvent:function(a){switch(a.type){case DOMEvents.DOM:this.onDOMContentLoaded();break;case DOMEvents.LOAD:if(!this.isWindowLoaded){for(this.isWindowLoaded=!0,EventBroadcaster.broadcast(this.WINDOW_LOADED_BROADCAST,this);this._onloadstatements.hasNext();)this._onloadstatements.getNext().fireOnLoad();this._currentDimensions=this.getWindowDimensions(),DOMEvents.addEventListener(window,DOMEvents.RESIZE,this),EventBroadcaster.broadcast(this.WINDOW_EVALUATED_BROADCAST,this),DOMEvents.removeEventListener(window,DOMEvents.LOAD,this),DOMEvents.stopPropagation(a)}break;case DOMEvents.RESIZE:for(window==top&&EventBroadcaster.broadcast(BroadcastMessages.MOUSEEVENT_MOUSEDOWN,document.body),this._onresizestatements.reset();this._onresizestatements.hasNext();)this._onresizestatements.getNext().fireOnResize();this._newDimensions=WindowManager.getWindowDimensions();var b=this._newDimensions.w!=this._currentDimensions.w,c=this._newDimensions.h!=this._currentDimensions.h;if(b||c){null!=this._broadcastTimeout&&(clearTimeout(this._broadcastTimeout),this._broadcastTimeout=null);var d=this;this._broadcastTimeout=setTimeout(function(){d._broadcastResizeEvent()},250)}break;case DOMEvents.UNLOAD:EventBroadcaster.broadcast(this.WINDOW_UNLOADED_BROADCAST)}},_broadcastResizeEvent:function(){clearTimeout(this._broadcastTimeout),this._broadcastTimeout=null,EventBroadcaster.broadcast(this.WINDOW_RESIZED_BROADCAST),this._currentDimensions=this._newDimensions},fireOnDOM:function(a){Interfaces.isImplemented(IDOMHandler,a,!0)&&this._ondomstatements.add(a)},fireOnLoad:function(a){Interfaces.isImplemented(ILoadHandler,a,!0)&&this._onloadstatements.add(a)},fireOnResize:function(a){Interfaces.isImplemented(IResizeHandler,a,!0)&&this._onresizestatements.add(a)},onDOMContentLoaded:function(){for(;this._ondomstatements.hasNext();)this._ondomstatements.getNext().fireOnDOM()},getWindowDimensions:function(){return new Dimension(Client.isMozilla?window.innerWidth:document.body.clientWidth,Client.isMozilla?window.innerHeight:document.body.clientHeight)},evaluate:function(string){return eval(string)}};var WindowManager=new _WindowManager;new function(){Client.isExplorer&&WindowManager.onDOMContentLoaded()},_DocumentUpdatePlugin.prototype={toString:function(){return"[DocumentUpdatePlugin]"},_logger:SystemLogger.getLogger("DocumentUpdatePlugin ["+document.title+"]"),_isUpdating:!1,_attributesbuffer:null,_elementsbuffer:null,isDebugging:Application.isDeveloperMode,_oldDOM:null,_focusID:null,_setup:function(){UpdateManager.isDebugging=Application.isDeveloperMode,UpdateManager.hasSoftAttributes=!0,UpdateManager.hasSoftSiblings=!0,DOMEvents.addEventListener(document,DOMEvents.BEFOREUPDATE,this),DOMEvents.addEventListener(document,DOMEvents.AFTERUPDATE,this),DOMEvents.addEventListener(document,DOMEvents.ERRORUPDATE,this),DOMEvents.addEventListener(window,DOMEvents.UNLOAD,this),Client.isFirefox&&(UpdateAssistant.serialize=function(a){return a=a.cloneNode(!0),a.setAttributeNS(Constants.NS_NS,"xmlns",Constants.NS_XHTML),a.setAttributeNS(Constants.NS_NS,"xmlns:ui",Constants.NS_UI),this._serializer.serializeToString(a)})},handleEvent:function(a){var b=DOMEvents.getTarget(a);switch(a.type){case DOMEvents.BEFOREUPDATE:this._beforeUpdate(b);break;case DOMEvents.AFTERUPDATE:this._afterUpdate(b);break;case DOMEvents.ERRORUPDATE:this._errorUpdate();break;case DOMEvents.UNLOAD:Application.hasLock(this)&&Application.unlock(this)}},_beforeUpdate:function(a){var b=a==document.documentElement;if(b){this._elementsbuffer=new List,this._isUpdating=!0,Application.lock(this);var c=UserInterface.getBinding(document.body);if(null!=c){var d=c.getDescendantBindingByType(PageBinding);null!=d&&d.onBeforeUpdates()}var e=FocusBinding.focusedBinding;null!=e&&(this._focusID=e.getID()),this.isDebugging&&(this._oldDOM=DOMSerializer.serialize(UpdateManager.currentDOM,!0))}else switch(a.__updateType){case Update.TYPE_REPLACE:case Update.TYPE_REMOVE:DocumentManager.detachBindings(a);break;case Update.TYPE_ATTRIBUTES:this._backupattributes(a,!1)}},_afterUpdate:function(a){var b=a==document.documentElement;if(b){var c=this._elementsbuffer;c.hasEntries()&&c.each(function(a){DocumentManager.attachBindings(a)}),this._isUpdating=!1,Application.unlock(this);var d=UserInterface.getBinding(document.body);if(null!=d){var e=d.getDescendantBindingByType(PageBinding);null!=e&&e.onAfterUpdates()}var f=FocusBinding.focusedBinding;if(null==f){var g=document.getElementById(this._focusID);if(null!=g){var f=UserInterface.getBinding(g);null!=f&&f.focus()}}if(this._focusID=null,""!=UpdateManager.summary){if(this.isDebugging){var h=DOMSerializer.serialize(UpdateManager.currentDOM,!0),i="NEW DOM: "+document.title+"\n\n"+h+"\n\n";i+="OLD DOM: "+document.title+"\n\n"+this._oldDOM,this._logger.debug(i),this._oldDOM=null}this._logger.fine(UpdateManager.summary)}}else{switch(a.__updateType){case Update.TYPE_REPLACE:case Update.TYPE_INSERT:a.__isAttached!==!1&&this._elementsbuffer.add(a);break;case Update.TYPE_ATTRIBUTES:this._backupattributes(a,!0)}switch(a.id){case"__VIEWSTATE":case"__EVENTTARGET":case"__EVENTARGUMENT":case"__EVENTVALIDATION":case"__LASTFOCUS":case"__REQUEST":case"__RESPONSE":case"__CONSOLEID":break;default:for(var f=UserInterface.getBinding(a);null==f&&null!=a;)f=UserInterface.getBinding(a),a=a.parentNode;null!=f&&f.dispatchAction(Binding.ACTION_UPDATED)}}},_errorUpdate:function(){Application.unlock(this);var a="UpdateManager dysfunction:\n\n"+UpdateManager.errorsmessage;this._logger.error(a+"\n\n"+UpdateManager.pendingResponse),Application.isDeveloperMode&&alert(a)},_backupattributes:function(a,b){var c=UserInterface.getBinding(a);if(null!=c)if(b){var d=this._attributesbuffer,e=new Map;d.each(function(b,c){var d=a.getAttribute(b);null!=d?d!=c&&e.set(b,Types.castFromString(d)):e.set(b,null)}),new List(a.attributes).each(function(a){a.specified&&(d.has(a.nodeName)||e.set(a.nodeName,Types.castFromString(a.nodeValue)))}),e.each(function(a,b){var d=c.propertyMethodMap[a];null!=d&&d.call(c,b)})}else{var e=new Map;new List(a.attributes).each(function(a){a.specified&&e.set(a.nodeName,a.nodeValue)}),this._attributesbuffer=e}},handleElement:function(a,b){var c=window.bindingMap[a.getAttribute("id")];if(null!=c)return c.handleElement(a,b)},updateElement:function(a,b){var c=window.bindingMap[a.getAttribute("id")];if(null!=c)return c.updateElement(a,b)}};var DocumentUpdatePlugin=new _DocumentUpdatePlugin;DocumentCrawler.prototype=new ElementCrawler,DocumentCrawler.prototype.constructor=DocumentCrawler,DocumentCrawler.superclass=ElementCrawler.prototype,DocumentCrawler.ID="documentcrawler",DocumentCrawler.MODE_REGISTER="register",DocumentCrawler.MODE_ATTACH="attach",DocumentCrawler.MODE_DETACH="detach",DocumentCrawler.prototype._construct=function(){DocumentCrawler.superclass._construct.call(this);var a=this;this.addFilter(function(b,c){var d=UserInterface.getBinding(b),e=null;switch(a.mode){case DocumentCrawler.MODE_REGISTER:null==d&&UserInterface.registerBinding(b);break;case DocumentCrawler.MODE_ATTACH:null!=d&&(d.isAttached||c.add(d),1==d.isLazy&&(e=NodeCrawler.SKIP_CHILDREN));break;case DocumentCrawler.MODE_DETACH:null!=d&&c.add(d)}return e})},_DocumentManager.prototype={_logger:SystemLogger.getLogger("DocumentManager ["+document.title+"]"),_maxIndex:-1,customUserInterfaceMapping:null,isDocumentSelectable:!1,hasNativeContextMenu:!1,_construct:function(){Application.framework(document),EventBroadcaster.subscribe(WindowManager.WINDOW_LOADED_BROADCAST,this),Client.isExplorer&&DOMEvents.addEventListener(document,DOMEvents.CLICK,this)},handleBroadcast:function(a,b){this.isDocumentSelectable||this._makeDocumentUnselectable(),this.hasNativeContextMenu||DOMEvents.addEventListener(document,DOMEvents.CONTEXTMENU,this),Application.isMalFunctional||(this._resolveCustomBindingMappings(),this.attachBindings(document.documentElement))},handleEvent:function(a){var b=DOMEvents.getTarget(a);switch(a.type){case DOMEvents.SELECTSTART:case DOMEvents.CONTEXTMENU:this._isTextInputElement(b)||DOMEvents.preventDefault(a);break;case DOMEvents.CLICK:Client.isExplorer&&null!=b&&null!=b.href&&b.href.indexOf(Constants.DUMMY_LINK)>-1&&DOMEvents.preventDefault(a)}},_resolveCustomBindingMappings:function(){var bindingset=DOMUtil.getElementsByTagName(document.documentElement,"bindingmappingset").item(0);if(null!=bindingset){var map={},mappings=DOMUtil.getElementsByTagName(bindingset,"bindingmapping");new List(mappings).each(function(mapping){var element=mapping.getAttribute("element"),binding=mapping.getAttribute("binding");map[element]=eval(binding)}),this.setCustomUserInterfaceMapping(new UserInterfaceMapping(map))}},setCustomUserInterfaceMapping:function(a){null==this.customUserInterfaceMapping?this.customUserInterfaceMapping=a:this.customUserInterfaceMapping.merge(a)},_registerBindings:function(a){var b=new DocumentCrawler;b.mode=DocumentCrawler.MODE_REGISTER,b.crawl(a),b.dispose()},_attachBindings:function(a){var b=new DocumentCrawler;b.mode=DocumentCrawler.MODE_ATTACH;var c=new List;b.crawl(a,c);for(var d=!1;c.hasNext();){var e=c.getNext();e.isAttached||(e.onBindingAttach(),e.memberDependencies||e.onBindingInitialize(),Interfaces.isImplemented(IData,e)&&(d=!0))}if(d){var f=UserInterface.getBinding(document.body);null!=f&&setTimeout(function(){Binding.exists(f)&&f.dispatchAction(FocusBinding.ACTION_UPDATE)},250)}b.dispose(),c.dispose()},attachBindings:function(a){this._registerBindings(a),this._attachBindings(a)},detachBindings:function(a,b){var c=new DocumentCrawler;c.mode=DocumentCrawler.MODE_DETACH;var d=new List;c.crawl(a,d),1==b&&d.extractFirst();var e=!1;if(d.reverse().each(function(a){Interfaces.isImplemented(IData,a)&&(e=!0),a.dispose(!0)}),e){var f=UserInterface.getBinding(document.body);null!=f&&setTimeout(function(){Binding.exists(f)&&f.dispatchAction(FocusBinding.ACTION_UPDATE)},250)}c.dispose(),d.dispose()},detachAllBindings:function(){this.detachBindings(document.documentElement)},computeMaxIndex:function(){return this._maxIndex==-1&&(this._maxIndex=DOMUtil.getMaxIndex(document)),this._maxIndex++},_isTextInputElement:function(a){return/textarea|input/.test(DOMUtil.getLocalName(a))},_makeDocumentUnselectable:function(){Client.isExplorer&&DOMEvents.addEventListener(document,DOMEvents.SELECTSTART,this)}};var DocumentManager=new _DocumentManager;_DataManager.prototype={isPostBackFun:!1,_logger:SystemLogger.getLogger("DataManager ["+document.title+"]"),_dataBindings:{},isDirty:!1,dirty:function(a){this.isDirty=!0;var b=!1;return null==a||a.isDirty||(a.isDirty=!0,a.dispatchAction(Binding.ACTION_DIRTY),b=!0),b},clean:function(a){a.isDirty&&(a.isDirty=!1)},registerDataBinding:function(a,b){if(!Interfaces.isImplemented(IData,b,!0))throw"Invalid DataBinding: "+b;if(null!=this._dataBindings[a])throw"no proper support for checkbox multiple values! "+a;this._dataBindings[a]=b},unRegisterDataBinding:function(a){null!=this._dataBindings[a]&&delete this._dataBindings[a]},getDataBinding:function(a){var b=null;return null!=this._dataBindings[a]&&(b=this._dataBindings[a]),b},getAllDataBindings:function(a){var b=new List;for(var c in this._dataBindings){var d=this._dataBindings[c];if(b.add(d),a&&d instanceof WindowBinding){var e=d.getContentWindow().DataManager;null!=e&&b.merge(e.getAllDataBindings())}}return b},hasDataBindings:function(){var a=!1;for(var b in this._dataBindings){a=!0;break}return a},populateDataBindings:function(a){a instanceof DataBindingMap&&a.each(function(b,c){var d=this._dataBindings[b];if(null!=d)switch(a.type){case DataBindingMap.TYPE_RESULT:try{d.setResult(c)}catch(a){throw Application.isDeveloperMode&&alert(d),a}break;case DataBindingMap.TYPE_VALUE:throw"Not implemented!"}})},getDataBindingValueMap:function(){var a=new DataBindingMap;a.type=DataBindingMap.TYPE_VALUE;for(var b in this._dataBindings){var c=this._dataBindings[b];if(c instanceof DataDialogBinding)throw"DataDialogBinding valuemap not supported!";a[b]=c.getValue()}return a},getDataBindingResultMap:function(){var a=new DataBindingMap;a.type=DataBindingMap.TYPE_RESULT;for(var b in this._dataBindings){var c=this._dataBindings[b],d=c.getResult();d instanceof DataBindingMap?d.each(function(b,c){a.set(b,c)}):a.set(b,d)}return a},getPostBackString:function(){var a="",b=document.forms[0];if(null!=b){var c="";new List(b.elements).each(function(b){var d=b.name,e=encodeURIComponent(b.value);switch(b.type){case"text":case"hidden":case"password":case"textarea":case"select-one":a+=d+"="+e+"&";break;case"submit":document.activeElement==b&&(a+=d+"="+e+"&");break;case"radio":b.checked&&(a+=d+"="+e+"&");break;case"checkbox":b.checked&&(b.name==c?(a.lastIndexOf("&")==a.length-1&&(a=a.substr(0,a.length-1)),a+=","+e):a+=d+"="+b.value,c=d,a+="&")}})}return a.substr(0,a.length-1)}};var DataManager=new _DataManager;
//# sourceMappingURL=sub.js.map