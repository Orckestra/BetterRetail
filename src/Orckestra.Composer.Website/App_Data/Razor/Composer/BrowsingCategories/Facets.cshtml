@inherits AsyncRazorFunction
@using System.Threading.Tasks
@using Orckestra.Composer.Search.Context;
@using Orckestra.Composer.Search.ViewModels

@functions {
    public override string FunctionDescription
    {
        get { return "Search Facets for Category Page"; }
    }

    public IBrowseCategoryRequestContext BrowsingRequestContext { get; set; }

    public override async Task InitializeAsync()
    {
        _categoryBrowsingViewModel = await BrowsingRequestContext.GetViewModelAsync();
    }

    private CategoryBrowsingViewModel _categoryBrowsingViewModel;
}

@{
    if (_categoryBrowsingViewModel == null)
    {
        return;
    }

    var facets = _categoryBrowsingViewModel.ProductSearchResults.Facets;
    if (facets == null || facets.Count == 0)
    {
        return;
    };
}

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://www.composite.net/ns/function/1.0">
<head>
</head>
<body>
    <div data-oc-controller="Product.FacetSearch" data-corrected-search-term="@_categoryBrowsingViewModel.ProductSearchResults.CorrectedSearchTerms">
        <form name="searchFacets">
            @FacetHelpers.PromotedFacetValues(_categoryBrowsingViewModel.ProductSearchResults.PromotedFacetValues)

            @foreach (var facet in facets)
            {
                if (!facet.IsDisplayed)
                {
                    continue;
                }
                <div class="card  bg-light  mb-3  facets-card"
                     data-facetfieldname="@facet.FieldName"
                     data-facettype="@facet.FacetType"
                     data-min="@facet.StartValue"
                     data-max="@facet.EndValue"
                     data-step="@facet.GapSize"
                     data-max-label="@Html.Localize("List-Search", "L_RangeAll")">
                    <div class="card-body"
                         data-qa="search-refiner">
                        <h5>@facet.Title</h5>
                        @FacetHelpers.RenderFacet(facet)
                    </div>
                </div>
            }
        </form>
    </div>
</body>
</html>